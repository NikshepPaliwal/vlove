<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Be My Valentine üíò</title>

    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(-45deg, #ff9a9e, #fad0c4, #fbc2eb, #a18cd1);
            background-size: 400% 400%;
            animation: bgMove 12s ease infinite;
            font-family: "Poppins", sans-serif;
            overflow: hidden; /* Prevent scrolling when button runs */
        }

        @keyframes bgMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- GLASS CARD DESIGN --- */
        .card {
            width: min(90%, 420px);
            padding: 40px 30px;
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 28px;
            text-align: center;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.15);
            z-index: 10;
            position: relative;
            transition: all 0.3s ease;
        }

        h1, h2 {
            font-family: "Playfair Display", serif;
            color: #4a1c2f;
            margin-bottom: 20px;
        }
        
        h1 { font-size: 2rem; }
        h2 { font-size: 1.8rem; line-height: 1.4; }
        p { color: #555; font-size: 0.95rem; margin-bottom: 20px; }

        /* --- INPUTS & BUTTONS --- */
        .input-group { text-align: left; margin-bottom: 15px; }
        label { font-size: 0.8rem; color: #d6336c; font-weight: 600; margin-left: 10px; text-transform: uppercase; }
        
        input, textarea {
            width: 100%; padding: 14px; margin-top: 5px;
            border-radius: 20px; border: 2px solid transparent;
            background: rgba(255, 255, 255, 0.8);
            font-family: inherit; font-size: 1rem; color: #333;
            transition: 0.3s;
        }
        input:focus, textarea:focus { outline: none; background: #fff; box-shadow: 0 5px 15px rgba(255, 107, 129, 0.2); }

        button {
            padding: 14px 36px; border-radius: 40px; border: none;
            font-size: 1rem; font-weight: 600; cursor: pointer;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
            width: 100%; margin-top: 10px;
        }
        button:active { transform: scale(0.95); }

        .btn-primary {
            background: linear-gradient(135deg, #ff4d6d, #ff758f);
            color: white;
        }
        .btn-secondary {
            background: rgba(255,255,255,0.5);
            color: #d6336c;
            border: 2px solid rgba(255,255,255,0.8);
        }

        /* --- RUNAWAY BUTTON --- */
        #no-btn {
            background: white; color: #555;
            position: absolute; /* Allows it to move freely */
            width: auto; padding: 10px 30px;
            z-index: 100;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .buttons-container {
            display: flex; justify-content: center; gap: 20px; min-height: 60px; align-items: center;
        }

        /* --- FLOATING HEARTS --- */
        .heart {
            position: absolute; bottom: -20px;
            animation: floatUp linear forwards;
            pointer-events: none; z-index: 0;
        }
        @keyframes floatUp {
            to { transform: translateY(-120vh); opacity: 0; }
        }

        .emoji { font-size: 60px; animation: heartbeat 1.5s infinite; margin-bottom: 10px; display:block; }
        @keyframes heartbeat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }

        /* Utility */
        .hidden { display: none; }
        .response-item {
            background: rgba(255,255,255,0.6); padding: 10px; border-radius: 15px;
            margin-bottom: 10px; text-align: left; font-size: 0.9rem;
            border-left: 4px solid #ff4d6d;
        }
        .footer {
            position: fixed; bottom: 10px; font-size: 12px; color: rgba(255,255,255,0.8); text-align: center;
        }
    </style>
</head>
<body>

    <div id="scene-login" class="card">
        <div class="emoji">üîí</div>
        <h1>Valentine App</h1>
        <p>Create a magic link for your crush, or login to view their answer.</p>
        
        <div class="input-group">
            <label>Secret Passcode</label>
            <input type="text" id="passcode" placeholder="e.g. Love123">
        </div>
        <button class="btn-primary" onclick="handleLogin()">Enter</button>
    </div>

    <div id="scene-dashboard" class="card hidden">
        <div class="emoji">üì¨</div>
        <h2>Your Dashboard</h2>
        <p>Send this link to your special someone:</p>
        
        <input type="text" id="share-link" readonly onclick="this.select()" style="text-align:center; font-size: 0.8rem; margin-bottom: 15px;">
        <button class="btn-primary" onclick="copyLink()">Copy Link üìã</button>
        
        <div style="margin-top: 30px; text-align: left; max-height: 200px; overflow-y: auto;">
            <label>Inbox:</label>
            <div id="responses-list" style="margin-top:10px;">Loading...</div>
        </div>
        
        <button class="btn-secondary" onclick="logout()" style="margin-top:20px;">Logout</button>
    </div>

    <div id="scene-receiver" class="hidden" style="width: 100%; display: flex; justify-content: center;">
        
        <div id="step-question" class="card">
            <div class="emoji">üê±‚ù§Ô∏è</div>
            <h2>Oyee,<br />will you be my Valentine?</h2>
            
            <div class="buttons-container">
                <button class="btn-primary" style="width: 120px;" onclick="handleYesClick()">Yes üíñ</button>
                <div style="width: 120px;"></div> 
            </div>
        </div>

        <button id="no-btn" class="hidden">No üò¢</button>

        <div id="step-form" class="card hidden">
            <div class="emoji">‚ú®</div>
            <p style="font-family: 'Playfair Display', serif; font-size: 1.1rem; color: #d6336c; font-style: italic;">
                "‡§§‡•á‡§∞‡•á ‡§ö‡•á‡§π‡§∞‡•á ‡§ï‡•á ‡§∞‡§Ç‡§ó ‡§∏‡•á ‡§ï‡•ã‡§à ‡§∞‡§Ç‡§ó ‡§ö‡•Å‡§∞‡§æ‡§®‡•á ‡§ï‡•ã ‡§¶‡§ø‡§≤ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à... <br>
                ‡§§‡•Ç ‡§π‡•à ‡§π‡•Ä ‡§ê‡§∏‡•Ä, ‡§ï‡§ø ‡§§‡•Å‡§ù‡•á ‡§ú‡§º‡§Æ‡§æ‡§®‡•á ‡§ï‡•ã ‡§¶‡§ø‡§ñ‡§æ‡§®‡•á ‡§ï‡§æ ‡§¶‡§ø‡§≤ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§ ‚ù§Ô∏è"
            </p>
            <p><strong>Yay! Please sign your name:</strong></p>
            
            <input type="text" id="r-name" placeholder="Your Name">
            <textarea id="r-msg" rows="2" placeholder="Any message? (Optional)"></textarea>
            
            <button class="btn-primary" onclick="sendReply()">Send My Love üíå</button>
        </div>

    </div>

    <footer class="footer">
        <p>@Ravikant ‚Ä¢ Made with love üíï</p>
    </footer>

    <script>
        // üëáüëá PASTE YOUR GOOGLE SCRIPT URL HERE üëáüëá
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwCVWi-VitF2yjjGstKeFfeTu9aF2XZE6IS9TkkhQzh_PpNsEth30P4kObnFotqOV-p/exec"; 

        // --- CORE LOGIC ---
        const urlParams = new URLSearchParams(window.location.search);
        const urlID = urlParams.get('id');
        const noBtn = document.getElementById("no-btn");

        // Initial Load
        window.onload = () => {
            startFloatingHearts();
            if (urlID) {
                // Show Receiver Scene
                showScene('scene-receiver');
                document.getElementById('no-btn').classList.remove('hidden');
                initRunawayButton();
            } else {
                // Show Login
                const savedPass = localStorage.getItem('v_pass');
                if(savedPass) {
                    document.getElementById('passcode').value = savedPass;
                    handleLogin();
                } else {
                    showScene('scene-login');
                }
            }
        };

        // --- LOGIN & DASHBOARD ---
        function handleLogin() {
            const pass = document.getElementById('passcode').value.trim();
            if(!pass) return alert("Enter a passcode!");
            
            localStorage.setItem('v_pass', pass);
            const uid = btoa(pass).replace(/=/g, '').substring(0, 10); // Create ID from pass
            
            showScene('scene-dashboard');
            document.getElementById('share-link').value = window.location.href.split('?')[0] + "?id=" + uid;
            fetchResponses(uid);
        }

        function fetchResponses(uid) {
            const list = document.getElementById('responses-list');
            list.innerHTML = "Checking...";
            
            fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({ action: "read", uid: uid })
            })
            .then(res => res.json())
            .then(res => {
                list.innerHTML = "";
                if(!res.data || res.data.length === 0) {
                    list.innerHTML = "<p>No answers yet.</p>";
                    return;
                }
                res.data.reverse().forEach(row => {
                    list.innerHTML += `
                    <div class="response-item">
                        <strong>${row.name}</strong> <span style="float:right">üíñ</span><br>
                        <small>"${row.msg}"</small>
                    </div>`;
                });
            });
        }

        // --- RECEIVER INTERACTION ---
        
        // 1. Runaway Button Logic
        function initRunawayButton() {
            const moveBtn = () => {
                const maxX = window.innerWidth - noBtn.offsetWidth - 20;
                const maxY = window.innerHeight - noBtn.offsetHeight - 20;
                const x = Math.random() * maxX;
                const y = Math.random() * maxY;
                noBtn.style.left = `${Math.max(10, x)}px`;
                noBtn.style.top = `${Math.max(10, y)}px`;
            };
            
            // Set initial position near the card
            const cardRect = document.querySelector('#step-question').getBoundingClientRect();
            noBtn.style.top = (cardRect.bottom + 20) + 'px';
            noBtn.style.left = (window.innerWidth/2 - noBtn.offsetWidth/2) + 'px';

            noBtn.addEventListener('mouseover', moveBtn);
            noBtn.addEventListener('touchstart', (e) => { e.preventDefault(); moveBtn(); });
            noBtn.addEventListener('click', moveBtn); // Just in case they click fast
        }

        // 2. Handle YES Click
        function handleYesClick() {
            confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } });
            
            // Hide Question, Show Form
            document.getElementById('step-question').classList.add('hidden');
            document.getElementById('no-btn').classList.add('hidden'); // Hide the runaway button
            
            // Show the form with the Poem
            const form = document.getElementById('step-form');
            form.classList.remove('hidden');
        }

        // 3. Send Data
        function sendReply() {
            const name = document.getElementById('r-name').value;
            const msg = document.getElementById('r-msg').value;
            
            if(!name) return alert("Please sign your name! ‚ù§Ô∏è");
            
            document.querySelector('#scene-receiver').innerHTML = "<div class='card'><h1>Sent! üíò</h1><p>Your answer has been delivered.</p></div>";
            confetti();

            fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    action: "save",
                    uid: urlID,
                    name: name,
                    msg: msg,
                    status: "YES"
                })
            });
        }

        // --- UTILS ---
        function showScene(id) {
            document.querySelectorAll('body > div').forEach(div => div.classList.add('hidden'));
            const el = document.getElementById(id);
            el.classList.remove('hidden');
            // Allow flex display for receiver scene
            if(id === 'scene-receiver') el.style.display = 'flex'; 
        }

        function copyLink() {
            const t = document.getElementById('share-link');
            t.select(); document.execCommand('copy');
            alert("Link Copied!");
        }

        function logout() {
            localStorage.removeItem('v_pass');
            location.reload();
        }

        function startFloatingHearts() {
            setInterval(() => {
                const heart = document.createElement("div");
                heart.className = "heart";
                heart.innerHTML = "‚ù§Ô∏è";
                heart.style.left = Math.random() * 100 + "vw";
                heart.style.fontSize = Math.random() * 20 + 10 + "px";
                heart.style.animationDuration = Math.random() * 3 + 2 + "s";
                document.body.appendChild(heart);
                setTimeout(() => heart.remove(), 5000);
            }, 400);
        }
    </script>
</body>
</html>
